{
  "version": 3,
  "sources": ["../../../src/builder/Transactions.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { BCS, fromB64 } from '@mysten/bcs';\nimport type { Infer, Struct } from 'superstruct';\nimport {\n\tis,\n\tany,\n\tarray,\n\tinteger,\n\tliteral,\n\tobject,\n\toptional,\n\tstring,\n\tunion,\n\tassert,\n\tdefine,\n\tunknown,\n\trecord,\n} from 'superstruct';\nimport { ObjectId, normalizeSuiObjectId } from '../types/common.js';\nimport type { WellKnownEncoding } from './utils.js';\nimport { TRANSACTION_TYPE, create } from './utils.js';\nimport { TypeTagSerializer } from '../signers/txn-data-serializers/type-tag-serializer.js';\n\nconst option = <T extends Struct<any, any>>(some: T) =>\n\tunion([object({ None: union([literal(true), literal(null)]) }), object({ Some: some })]);\n\nexport const TransactionBlockInput = object({\n\tkind: literal('Input'),\n\tindex: integer(),\n\tvalue: optional(any()),\n\ttype: optional(union([literal('pure'), literal('object')])),\n});\nexport type TransactionBlockInput = Infer<typeof TransactionBlockInput>;\n\nconst TransactionArgumentTypes = [\n\tTransactionBlockInput,\n\tobject({ kind: literal('GasCoin') }),\n\tobject({ kind: literal('Result'), index: integer() }),\n\tobject({\n\t\tkind: literal('NestedResult'),\n\t\tindex: integer(),\n\t\tresultIndex: integer(),\n\t}),\n] as const;\n\n// Generic transaction argument\nexport const TransactionArgument = union([...TransactionArgumentTypes]);\nexport type TransactionArgument = Infer<typeof TransactionArgument>;\n\n// Transaction argument referring to an object:\nexport const ObjectTransactionArgument = union([...TransactionArgumentTypes]);\n(ObjectTransactionArgument as any)[TRANSACTION_TYPE] = {\n\tkind: 'object',\n} as WellKnownEncoding;\n\nexport const PureTransactionArgument = (type: string) => {\n\tconst struct = union([...TransactionArgumentTypes]);\n\t(struct as any)[TRANSACTION_TYPE] = {\n\t\tkind: 'pure',\n\t\ttype,\n\t} as WellKnownEncoding;\n\treturn struct;\n};\n\nexport const MoveCallTransaction = object({\n\tkind: literal('MoveCall'),\n\ttarget: define<`${string}::${string}::${string}`>('target', string().validator),\n\ttypeArguments: array(string()),\n\targuments: array(TransactionArgument),\n});\nexport type MoveCallTransaction = Infer<typeof MoveCallTransaction>;\n\nexport const TransferObjectsTransaction = object({\n\tkind: literal('TransferObjects'),\n\tobjects: array(ObjectTransactionArgument),\n\taddress: PureTransactionArgument(BCS.ADDRESS),\n});\nexport type TransferObjectsTransaction = Infer<typeof TransferObjectsTransaction>;\n\nexport const SplitCoinsTransaction = object({\n\tkind: literal('SplitCoins'),\n\tcoin: ObjectTransactionArgument,\n\tamounts: array(PureTransactionArgument('u64')),\n});\nexport type SplitCoinsTransaction = Infer<typeof SplitCoinsTransaction>;\n\nexport const MergeCoinsTransaction = object({\n\tkind: literal('MergeCoins'),\n\tdestination: ObjectTransactionArgument,\n\tsources: array(ObjectTransactionArgument),\n});\nexport type MergeCoinsTransaction = Infer<typeof MergeCoinsTransaction>;\n\nexport const MakeMoveVecTransaction = object({\n\tkind: literal('MakeMoveVec'),\n\t// TODO: ideally we should use `TypeTag` instead of `record()` here,\n\t// but TypeTag is recursively defined and it's tricky to define a\n\t// recursive struct in superstruct\n\ttype: optional(option(record(string(), unknown()))),\n\tobjects: array(ObjectTransactionArgument),\n});\nexport type MakeMoveVecTransaction = Infer<typeof MakeMoveVecTransaction>;\n\nexport const PublishTransaction = object({\n\tkind: literal('Publish'),\n\tmodules: array(array(integer())),\n\tdependencies: array(ObjectId),\n});\nexport type PublishTransaction = Infer<typeof PublishTransaction>;\n\n// Keep in sync with constants in\n// crates/sui-framework/packages/sui-framework/sources/package.move\nexport enum UpgradePolicy {\n\tCOMPATIBLE = 0,\n\tADDITIVE = 128,\n\tDEP_ONLY = 192,\n}\n\nexport const UpgradeTransaction = object({\n\tkind: literal('Upgrade'),\n\tmodules: array(array(integer())),\n\tdependencies: array(ObjectId),\n\tpackageId: ObjectId,\n\tticket: ObjectTransactionArgument,\n});\nexport type UpgradeTransaction = Infer<typeof UpgradeTransaction>;\n\nconst TransactionTypes = [\n\tMoveCallTransaction,\n\tTransferObjectsTransaction,\n\tSplitCoinsTransaction,\n\tMergeCoinsTransaction,\n\tPublishTransaction,\n\tUpgradeTransaction,\n\tMakeMoveVecTransaction,\n] as const;\n\nexport const TransactionType = union([...TransactionTypes]);\nexport type TransactionType = Infer<typeof TransactionType>;\n\nexport function getTransactionType(data: unknown) {\n\tassert(data, TransactionType);\n\treturn TransactionTypes.find((schema) => is(data, schema as Struct))!;\n}\n\n/**\n * Simple helpers used to construct transactions:\n */\nexport const Transactions = {\n\tMoveCall(\n\t\tinput: Omit<MoveCallTransaction, 'kind' | 'arguments' | 'typeArguments'> & {\n\t\t\targuments?: TransactionArgument[];\n\t\t\ttypeArguments?: string[];\n\t\t},\n\t): MoveCallTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'MoveCall',\n\t\t\t\ttarget: input.target,\n\t\t\t\targuments: input.arguments ?? [],\n\t\t\t\ttypeArguments: input.typeArguments ?? [],\n\t\t\t},\n\t\t\tMoveCallTransaction,\n\t\t);\n\t},\n\tTransferObjects(\n\t\tobjects: TransactionArgument[],\n\t\taddress: TransactionArgument,\n\t): TransferObjectsTransaction {\n\t\treturn create({ kind: 'TransferObjects', objects, address }, TransferObjectsTransaction);\n\t},\n\tSplitCoins(coin: TransactionArgument, amounts: TransactionArgument[]): SplitCoinsTransaction {\n\t\treturn create({ kind: 'SplitCoins', coin, amounts }, SplitCoinsTransaction);\n\t},\n\tMergeCoins(\n\t\tdestination: TransactionArgument,\n\t\tsources: TransactionArgument[],\n\t): MergeCoinsTransaction {\n\t\treturn create({ kind: 'MergeCoins', destination, sources }, MergeCoinsTransaction);\n\t},\n\tPublish({\n\t\tmodules,\n\t\tdependencies,\n\t}: {\n\t\tmodules: number[][] | string[];\n\t\tdependencies: ObjectId[];\n\t}): PublishTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'Publish',\n\t\t\t\tmodules: modules.map((module) =>\n\t\t\t\t\ttypeof module === 'string' ? Array.from(fromB64(module)) : module,\n\t\t\t\t),\n\t\t\t\tdependencies: dependencies.map((dep) => normalizeSuiObjectId(dep)),\n\t\t\t},\n\t\t\tPublishTransaction,\n\t\t);\n\t},\n\tUpgrade({\n\t\tmodules,\n\t\tdependencies,\n\t\tpackageId,\n\t\tticket,\n\t}: {\n\t\tmodules: number[][] | string[];\n\t\tdependencies: ObjectId[];\n\t\tpackageId: ObjectId;\n\t\tticket: TransactionArgument;\n\t}): UpgradeTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'Upgrade',\n\t\t\t\tmodules: modules.map((module) =>\n\t\t\t\t\ttypeof module === 'string' ? Array.from(fromB64(module)) : module,\n\t\t\t\t),\n\t\t\t\tdependencies: dependencies.map((dep) => normalizeSuiObjectId(dep)),\n\t\t\t\tpackageId,\n\t\t\t\tticket,\n\t\t\t},\n\t\t\tUpgradeTransaction,\n\t\t);\n\t},\n\tMakeMoveVec({\n\t\ttype,\n\t\tobjects,\n\t}: Omit<MakeMoveVecTransaction, 'kind' | 'type'> & {\n\t\ttype?: string;\n\t}): MakeMoveVecTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'MakeMoveVec',\n\t\t\t\ttype: type ? { Some: TypeTagSerializer.parseFromStr(type) } : { None: null },\n\t\t\t\tobjects,\n\t\t\t},\n\t\t\tMakeMoveVecTransaction,\n\t\t);\n\t},\n};\n"],
  "mappings": "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",
  "names": ["UpgradePolicy", "module"]
}
