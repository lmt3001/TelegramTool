{
  "version": 3,
  "sources": ["../../../src/builder/Transactions.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { BCS, fromB64 } from '@mysten/bcs';\nimport type { Infer, Struct } from 'superstruct';\nimport {\n\tis,\n\tany,\n\tarray,\n\tinteger,\n\tliteral,\n\tobject,\n\toptional,\n\tstring,\n\tunion,\n\tassert,\n\tdefine,\n\tunknown,\n\trecord,\n} from 'superstruct';\nimport { ObjectId, normalizeSuiObjectId } from '../types/common.js';\nimport type { WellKnownEncoding } from './utils.js';\nimport { TRANSACTION_TYPE, create } from './utils.js';\nimport { TypeTagSerializer } from '../signers/txn-data-serializers/type-tag-serializer.js';\n\nconst option = <T extends Struct<any, any>>(some: T) =>\n\tunion([object({ None: union([literal(true), literal(null)]) }), object({ Some: some })]);\n\nexport const TransactionBlockInput = object({\n\tkind: literal('Input'),\n\tindex: integer(),\n\tvalue: optional(any()),\n\ttype: optional(union([literal('pure'), literal('object')])),\n});\nexport type TransactionBlockInput = Infer<typeof TransactionBlockInput>;\n\nconst TransactionArgumentTypes = [\n\tTransactionBlockInput,\n\tobject({ kind: literal('GasCoin') }),\n\tobject({ kind: literal('Result'), index: integer() }),\n\tobject({\n\t\tkind: literal('NestedResult'),\n\t\tindex: integer(),\n\t\tresultIndex: integer(),\n\t}),\n] as const;\n\n// Generic transaction argument\nexport const TransactionArgument = union([...TransactionArgumentTypes]);\nexport type TransactionArgument = Infer<typeof TransactionArgument>;\n\n// Transaction argument referring to an object:\nexport const ObjectTransactionArgument = union([...TransactionArgumentTypes]);\n(ObjectTransactionArgument as any)[TRANSACTION_TYPE] = {\n\tkind: 'object',\n} as WellKnownEncoding;\n\nexport const PureTransactionArgument = (type: string) => {\n\tconst struct = union([...TransactionArgumentTypes]);\n\t(struct as any)[TRANSACTION_TYPE] = {\n\t\tkind: 'pure',\n\t\ttype,\n\t} as WellKnownEncoding;\n\treturn struct;\n};\n\nexport const MoveCallTransaction = object({\n\tkind: literal('MoveCall'),\n\ttarget: define<`${string}::${string}::${string}`>('target', string().validator),\n\ttypeArguments: array(string()),\n\targuments: array(TransactionArgument),\n});\nexport type MoveCallTransaction = Infer<typeof MoveCallTransaction>;\n\nexport const TransferObjectsTransaction = object({\n\tkind: literal('TransferObjects'),\n\tobjects: array(ObjectTransactionArgument),\n\taddress: PureTransactionArgument(BCS.ADDRESS),\n});\nexport type TransferObjectsTransaction = Infer<typeof TransferObjectsTransaction>;\n\nexport const SplitCoinsTransaction = object({\n\tkind: literal('SplitCoins'),\n\tcoin: ObjectTransactionArgument,\n\tamounts: array(PureTransactionArgument('u64')),\n});\nexport type SplitCoinsTransaction = Infer<typeof SplitCoinsTransaction>;\n\nexport const MergeCoinsTransaction = object({\n\tkind: literal('MergeCoins'),\n\tdestination: ObjectTransactionArgument,\n\tsources: array(ObjectTransactionArgument),\n});\nexport type MergeCoinsTransaction = Infer<typeof MergeCoinsTransaction>;\n\nexport const MakeMoveVecTransaction = object({\n\tkind: literal('MakeMoveVec'),\n\t// TODO: ideally we should use `TypeTag` instead of `record()` here,\n\t// but TypeTag is recursively defined and it's tricky to define a\n\t// recursive struct in superstruct\n\ttype: optional(option(record(string(), unknown()))),\n\tobjects: array(ObjectTransactionArgument),\n});\nexport type MakeMoveVecTransaction = Infer<typeof MakeMoveVecTransaction>;\n\nexport const PublishTransaction = object({\n\tkind: literal('Publish'),\n\tmodules: array(array(integer())),\n\tdependencies: array(ObjectId),\n});\nexport type PublishTransaction = Infer<typeof PublishTransaction>;\n\n// Keep in sync with constants in\n// crates/sui-framework/packages/sui-framework/sources/package.move\nexport enum UpgradePolicy {\n\tCOMPATIBLE = 0,\n\tADDITIVE = 128,\n\tDEP_ONLY = 192,\n}\n\nexport const UpgradeTransaction = object({\n\tkind: literal('Upgrade'),\n\tmodules: array(array(integer())),\n\tdependencies: array(ObjectId),\n\tpackageId: ObjectId,\n\tticket: ObjectTransactionArgument,\n});\nexport type UpgradeTransaction = Infer<typeof UpgradeTransaction>;\n\nconst TransactionTypes = [\n\tMoveCallTransaction,\n\tTransferObjectsTransaction,\n\tSplitCoinsTransaction,\n\tMergeCoinsTransaction,\n\tPublishTransaction,\n\tUpgradeTransaction,\n\tMakeMoveVecTransaction,\n] as const;\n\nexport const TransactionType = union([...TransactionTypes]);\nexport type TransactionType = Infer<typeof TransactionType>;\n\nexport function getTransactionType(data: unknown) {\n\tassert(data, TransactionType);\n\treturn TransactionTypes.find((schema) => is(data, schema as Struct))!;\n}\n\n/**\n * Simple helpers used to construct transactions:\n */\nexport const Transactions = {\n\tMoveCall(\n\t\tinput: Omit<MoveCallTransaction, 'kind' | 'arguments' | 'typeArguments'> & {\n\t\t\targuments?: TransactionArgument[];\n\t\t\ttypeArguments?: string[];\n\t\t},\n\t): MoveCallTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'MoveCall',\n\t\t\t\ttarget: input.target,\n\t\t\t\targuments: input.arguments ?? [],\n\t\t\t\ttypeArguments: input.typeArguments ?? [],\n\t\t\t},\n\t\t\tMoveCallTransaction,\n\t\t);\n\t},\n\tTransferObjects(\n\t\tobjects: TransactionArgument[],\n\t\taddress: TransactionArgument,\n\t): TransferObjectsTransaction {\n\t\treturn create({ kind: 'TransferObjects', objects, address }, TransferObjectsTransaction);\n\t},\n\tSplitCoins(coin: TransactionArgument, amounts: TransactionArgument[]): SplitCoinsTransaction {\n\t\treturn create({ kind: 'SplitCoins', coin, amounts }, SplitCoinsTransaction);\n\t},\n\tMergeCoins(\n\t\tdestination: TransactionArgument,\n\t\tsources: TransactionArgument[],\n\t): MergeCoinsTransaction {\n\t\treturn create({ kind: 'MergeCoins', destination, sources }, MergeCoinsTransaction);\n\t},\n\tPublish({\n\t\tmodules,\n\t\tdependencies,\n\t}: {\n\t\tmodules: number[][] | string[];\n\t\tdependencies: ObjectId[];\n\t}): PublishTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'Publish',\n\t\t\t\tmodules: modules.map((module) =>\n\t\t\t\t\ttypeof module === 'string' ? Array.from(fromB64(module)) : module,\n\t\t\t\t),\n\t\t\t\tdependencies: dependencies.map((dep) => normalizeSuiObjectId(dep)),\n\t\t\t},\n\t\t\tPublishTransaction,\n\t\t);\n\t},\n\tUpgrade({\n\t\tmodules,\n\t\tdependencies,\n\t\tpackageId,\n\t\tticket,\n\t}: {\n\t\tmodules: number[][] | string[];\n\t\tdependencies: ObjectId[];\n\t\tpackageId: ObjectId;\n\t\tticket: TransactionArgument;\n\t}): UpgradeTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'Upgrade',\n\t\t\t\tmodules: modules.map((module) =>\n\t\t\t\t\ttypeof module === 'string' ? Array.from(fromB64(module)) : module,\n\t\t\t\t),\n\t\t\t\tdependencies: dependencies.map((dep) => normalizeSuiObjectId(dep)),\n\t\t\t\tpackageId,\n\t\t\t\tticket,\n\t\t\t},\n\t\t\tUpgradeTransaction,\n\t\t);\n\t},\n\tMakeMoveVec({\n\t\ttype,\n\t\tobjects,\n\t}: Omit<MakeMoveVecTransaction, 'kind' | 'type'> & {\n\t\ttype?: string;\n\t}): MakeMoveVecTransaction {\n\t\treturn create(\n\t\t\t{\n\t\t\t\tkind: 'MakeMoveVec',\n\t\t\t\ttype: type ? { Some: TypeTagSerializer.parseFromStr(type) } : { None: null },\n\t\t\t\tobjects,\n\t\t\t},\n\t\t\tMakeMoveVecTransaction,\n\t\t);\n\t},\n};\n"],
  "mappings": "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",
  "names": ["UpgradePolicy"]
}
